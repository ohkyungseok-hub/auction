<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì¼“ë² ë¥´ë° ì‡¼í•‘ëª° - ë§ˆì´í˜ì´ì§€</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-top">
            <div class="container">
                <div class="logo">ë§ˆì¼“ë² ë¥´ë°</div>
                <div class="header-right">
                    <div class="search-box">
                        <input type="text" placeholder="ìƒí’ˆ ê²€ìƒ‰..." id="search-input">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                    <div class="header-icons">
                        <a href="#" class="cart-icon">ğŸ›’ <span class="badge">0</span></a>
                        <a href="mypage.html" class="user-icon active">ğŸ‘¤</a>
                        <a href="#" class="login-btn" id="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                </div>
            </div>
        </div>
        <nav class="main-nav">
            <div class="container">
                <a href="index.html">í™ˆ</a>
                <a href="index.html#products">ê²½ë§¤ ëª©ë¡</a>
                <a href="register.html">ê²½ë§¤ ë“±ë¡</a>
                <a href="http://localhost:8000/index.html#best" class="active">ë§ˆì¼“ë² ë¥´ë° ì‡¼í•‘ëª°</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="mypage-header">
            <div class="user-profile">
                <div class="profile-avatar">ğŸ‘¤</div>
                <div class="profile-info">
                    <h2 id="user-name">ì‚¬ìš©ì</h2>
                    <p id="user-email">ì´ë©”ì¼</p>
                </div>
            </div>
        </div>

        <div class="mypage-tabs">
            <button class="tab-btn active" onclick="showTab('bids')">ë‚´ ì…ì°° ë‚´ì—­</button>
            <button class="tab-btn" onclick="showTab('products')">ë‚´ ìƒí’ˆ</button>
            <button class="tab-btn" onclick="showTab('profile')">í”„ë¡œí•„</button>
        </div>

        <!-- ë‚´ ì…ì°° ë‚´ì—­ -->
        <div id="tab-bids" class="tab-content active">
            <h3>ë‚´ ì…ì°° ë‚´ì—­</h3>
            <div id="my-bids-container" class="bids-container">
                <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë‚´ ìƒí’ˆ (ìœ í†µì—…ì²´ìš©) -->
        <div id="tab-products" class="tab-content">
            <h3>ë“±ë¡í•œ ìƒí’ˆ</h3>
            <div id="my-products-container" class="products-grid">
                <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- í”„ë¡œí•„ -->
        <div id="tab-profile" class="tab-content">
            <h3>í”„ë¡œí•„ ì„¤ì •</h3>
            <div class="form-container">
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-name">ì´ë¦„</label>
                        <input type="text" id="profile-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="profile-email">ì´ë©”ì¼</label>
                        <input type="email" id="profile-email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="profile-phone">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="profile-phone" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="profile-company">íšŒì‚¬ëª…</label>
                        <input type="text" id="profile-company" placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // ë¡œê·¸ì¸ í™•ì¸
        function checkLogin() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return false;
            }
            return currentUser;
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            localStorage.removeItem('currentUser');
            sessionStorage.removeItem('currentUser');
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = 'index.html';
        }

        // íƒ­ ì „í™˜
        let currentTab = 'bids';
        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`tab-${tab}`).classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'bids') {
                renderMyBids();
            } else if (tab === 'products') {
                renderMyProducts();
            }
        }

        // ë‚´ ì…ì°° ë‚´ì—­ ë Œë”ë§
        function renderMyBids() {
            const user = checkLogin();
            if (!user) return;
            
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const container = document.getElementById('my-bids-container');
            
            let myBids = [];
            products.forEach(product => {
                if (product.bids) {
                    product.bids.forEach(bid => {
                        // ì…ì°°ìëª… ë˜ëŠ” ì´ë©”ì¼ë¡œ ë§¤ì¹­
                        const nameMatch = bid.bidderName && (bid.bidderName === user.name || bid.bidderName === user.email.split('@')[0]);
                        const emailMatch = bid.bidderEmail && bid.bidderEmail === user.email;
                        if (nameMatch || emailMatch) {
                            myBids.push({
                                ...bid,
                                productName: product.name,
                                productId: product.id,
                                auctionEndDate: product.auctionEndDate,
                                minPrice: product.minPrice
                            });
                        }
                    });
                }
            });
            
            if (myBids.length === 0) {
                container.innerHTML = '<p class="no-data">ì…ì°° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ì‹œê°„ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            myBids.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = myBids.map(bid => {
                const isEnded = new Date(bid.auctionEndDate) < new Date();
                return `
                <div class="bid-card ${isEnded ? 'ended' : ''}">
                    <div class="bid-card-header">
                        <h4>${bid.productName}</h4>
                        <span class="bid-amount">${bid.amount.toLocaleString()}ì›</span>
                    </div>
                    <div class="bid-card-info">
                        <p>ì…ì°° ì‹œê°„: ${new Date(bid.timestamp).toLocaleString('ko-KR')}</p>
                        <p>ê²½ë§¤ ì¢…ë£Œ: ${new Date(bid.auctionEndDate).toLocaleString('ko-KR')}</p>
                        <p>ìµœì €ê°€: ${bid.minPrice.toLocaleString()}ì›</p>
                        <p class="bid-status">${isEnded ? 'ê²½ë§¤ ì¢…ë£Œ' : 'ì§„í–‰ ì¤‘'}</p>
                    </div>
                </div>
            `;
            }).join('');
        }

        // ë‚´ ìƒí’ˆ ë Œë”ë§ (ìœ í†µì—…ì²´ìš©)
        function renderMyProducts() {
            const user = checkLogin();
            if (!user) return;
            
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const container = document.getElementById('my-products-container');
            
            const myProducts = products.filter(p => p.supplierName === user.name || p.supplierEmail === user.email);
            
            if (myProducts.length === 0) {
                container.innerHTML = '<p class="no-data">ë“±ë¡í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = myProducts.map(product => `
                <div class="product-card">
                    <div class="product-header">
                        <div class="product-name">${product.name}</div>
                    </div>
                    <div class="product-info">
                        <div class="product-info-item">
                            <span class="product-info-label">ì…ì°° ìˆ˜</span>
                            <span class="product-info-value">${product.bids ? product.bids.length : 0}ê±´</span>
                        </div>
                        <div class="product-info-item">
                            <span class="product-info-label">ìµœì €ê°€</span>
                            <span class="product-info-value">${product.minPrice.toLocaleString()}ì›</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">ìƒì„¸ë³´ê¸°</button>
                </div>
            `).join('');
        }

        // í”„ë¡œí•„ ë¡œë“œ
        function loadProfile() {
            const user = checkLogin();
            if (!user) return;
            
            document.getElementById('user-name').textContent = user.name || 'ì‚¬ìš©ì';
            document.getElementById('user-email').textContent = user.email || '';
            document.getElementById('profile-name').value = user.name || '';
            document.getElementById('profile-email').value = user.email || '';
        }

        // í”„ë¡œí•„ ì €ì¥
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const user = checkLogin();
            if (!user) return;
            
            user.name = document.getElementById('profile-name').value;
            user.email = document.getElementById('profile-email').value;
            user.phone = document.getElementById('profile-phone').value;
            user.company = document.getElementById('profile-company').value;
            
            localStorage.setItem('currentUser', JSON.stringify(user));
            alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadProfile();
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            loadProfile();
            renderMyBids();
        });
    </script>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>ë§ˆì¼“ë² ë¥´ë°</h3>
                    <p>íšŒì‚¬ëª…: ì—ì´í¬ìŠ¤</p>
                    <p>ëŒ€í‘œì: í™©ì§€í›„</p>
                </div>
                <div class="footer-links">
                    <a href="index.html">í™ˆ</a>
                    <a href="index.html#products">ê²½ë§¤ ëª©ë¡</a>
                    <a href="register.html">ê²½ë§¤ ë“±ë¡</a>
                    <a href="http://localhost:8000/index.html#best">ë§ˆì¼“ë² ë¥´ë° ì‡¼í•‘ëª°</a>
                    <a href="backoffice-login.html">ë°±ì˜¤í”¼ìŠ¤</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 ë§ˆì¼“ë² ë¥´ë° (ì—ì´í¬ìŠ¤). All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>
